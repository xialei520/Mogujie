!function(t){t.MWP=function(){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t){var e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]*)(;|$)"));return null!==e?decodeURIComponent(e[2]):""}function r(t,e){if(void 0===e&&(e=!0),!t)return"";var n=e?encodeURIComponent:S;return Object.keys(t).map(function(e){var r=t[e];return e=n(e),Array.isArray(r)?r.map(function(t,r){return e+"["+r+"]="+n(t)}).join("&"):e+"="+n(r)}).join("&")}function o(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}function i(t,e,n){function r(){i.parentNode&&i.parentNode.removeChild(i);try{delete window[a]}catch(t){window[a]=void 0}}var i,a=e.jsonpCallback||"httpCb"+f();window[a]=function(t){r(),n(null,t)},t=c(t,Object.assign({},e.data,{callback:a,_:Date.now()})),i=document.createElement("script"),i.src=t,i.type="text/javascript",i.async=!0;var s=function(){r(),n(new Error(x))};P&&"onreadystatechange"in i?i.onreadystatechange=function(){"complete"===i.readyState&&(i.onreadystatechange=null,o(i));var t=i.readyState;try{i.children}catch(e){}"loaded"===t&&"loading"===i.readyState&&(i.onreadystatechange=null,s())}:(i.onerror=s,o(i))}function a(t,e,n){var o=e.data,i=new XMLHttpRequest;"GET"===e.method&&(t=c(t,o),o=null),i.open(e.method,t),i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(i.onreadystatechange=function(){},200===i.status)try{var t;t="json"===e.dataType?""===i.responseText?null:JSON.parse(i.responseText):i.responseText,n(null,t)}catch(r){n(r)}else n(new Error(x))};try{switch(i.setRequestHeader("Content-Type",e.contentType),e.contentType){case O.text:case O.form:i.send(o?r(o):null);break;case O.json:i.send(o?JSON.stringify(o):null);break;default:i.send(o)}}catch(a){n(a)}}function s(t,e,n){var o={method:e.method,headers:{"Content-Type":e.contentType},credentials:"include"};if("GET"===e.method)t=c(t,e.data);else switch(e.contentType){case O.text:case O.form:o.body=r(e.data);break;case O.json:o.body=JSON.stringify(e.data)}u(t)||(o.mode="cors"),j(t,o).then(function(t){switch(e.dataType){case"json":return t.json();case"text":default:return t.text()}}).then(function(t){n(null,t)})["catch"](function(){n(new Error(x))})}function u(t){try{var e=document.createElement("a");return e.href=t,e.href=e.href,e.protocol===R.protocol&&e.hostname===R.hostname&&e.port===R.port}catch(n){return!0}}function c(t,e){if(e){var n=r(e);n&&(t+=(~t.indexOf("?")?"&":"?")+n)}return t}function f(){return String(Date.now())+String((90*Math.random()|0)+10)}function h(){return++window._mwpJsonpID||(window._mwpJsonpID=1)}function d(t){if(t.ret===I.Success)return t.data;var e=new Error(t.msg||"\u670d\u52a1\u5668\u5f00\u5c0f\u5dee\u4e86\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5");throw e.code=t.ret,e}function p(){var t=window.location.search;return~t.indexOf("__pre")?D.PreRelease:~t.indexOf("__test")?D.Develop:void 0}function l(){if(window.MOGU_ENV)switch(window.MOGU_ENV){case"test":case"daily":return D.Develop;case"develop":case"local":case"pre":return D.PreRelease}else if(window.MOGU_DEV)return D.PreRelease}function y(t){return t&&"function"==typeof t.then}function v(){this._data={}}function m(t){this._MWP=t,this._callbacks={}}function g(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function w(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&g(t.slice(0,0))}function _(t){return t?"string"==typeof t?t:JSON.stringify(t):""}function T(t){this._params={},this.add(q,t.AppKey).add(G,String(Date.now())).add(U,t.TTID)}var b="undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:{},E=e(function(t){!function(e){function n(){}function r(t,e){return function(){t.apply(e,arguments)}}function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function i(t,e){for(;3===t._state;)t=t._value;return 0===t._state?void t._deferreds.push(e):(t._handled=!0,void d(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?a:s)(e.promise,t._value);var r;try{r=n(t._value)}catch(o){return void s(e.promise,o)}a(e.promise,r)}))}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void f(r(n,e),t)}t._state=1,t._value=e,u(t)}catch(i){s(t,i)}}function s(t,e){t._state=2,t._value=e,u(t)}function u(t){2===t._state&&0===t._deferreds.length&&d(function(){t._handled||p(t._value)});for(var e=0,n=t._deferreds.length;n>e;e++)i(t,t._deferreds[e]);t._deferreds=null}function c(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,s(e,t))})}catch(r){if(n)return;n=!0,s(e,r)}}var h=setTimeout,d="function"==typeof setImmediate&&setImmediate||function(t){h(t,1)},p=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};o.prototype["catch"]=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var r=new this.constructor(n);return i(this,new c(t,e,r)),r},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(t){r(i,t)},n)}e[i]=a,0===--o&&t(e)}catch(u){n(u)}}if(0===e.length)return t([]);for(var o=e.length,i=0;i<e.length;i++)r(i,e[i])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,o=t.length;o>r;r++)t[r].then(e,n)})},o._setImmediateFn=function(t){d=t},o._setUnhandledRejectionFn=function(t){p=t},"undefined"!=typeof t&&t.exports?t.exports=o:e.Promise||(e.Promise=o)}(b)}),S=(Object.prototype.hasOwnProperty,function(t){return t}),j=window.fetch,R=window.location,O={text:"text/plain; charset=utf-8",form:"application/x-www-form-urlencoded; charset=UTF-8",json:"application/json; charset=UTF-8"},P=window.navigator.userAgent.indexOf("MSIE 8.0")>=0,x="\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5",D=({method:"GET",dataType:"json",contentType:O.form,forceXHR:!1,useHTTPS:!1},{Develop:"DEVELOP",PreRelease:"PRE_RELEASE",Release:"RELEASE"}),k={Develop:"devapi.mogujie.com",PreRelease:"newpreapi.mogujie.com",Release:"api.mogujie.com"},I={Success:"SUCCESS",NeedHttps:"FAIL_SYS_NEED_HTTPS",TokenNeedRenew:"FAIL_SYS_TOKEN_NEED_RENEW",SessionInvalid:"FAIL_BIZ_SESSION_INVALID"},N="_mwp_h5_token",A=Object.prototype.hasOwnProperty;v.prototype.add=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._data[t+"."+e]=n,this},v.prototype.toObject=function(){return this._data},m.Parameter=v,m.prototype.addParameter=function(t,e,n){return this._parameter||(this._parameter=new v),this._parameter.add(t,e,n),this},m.prototype.request=function(t,e,n,r){var o=this,i=void 0;return n instanceof v?i=n.toObject():(i=this._parameter?this._parameter.toObject():null,r||(r=n||{})),this._promise=this._MWP.request(t,e,i,r).then(function(t){return o.result=t,o._MWP.filterResult(t)}).then(function(t){var e=[];for(var n in t)A.call(t,n)&&o._callbacks[n]&&e.push(o._callbacks[n](t[n]));return e=e.filter(y),e.length>0?E.all(e).then(function(){return o.result}):o.result}),this},m.prototype.on=function(t,e){return this._callbacks[t]||(this._callbacks[t]=e),this},m.prototype.then=function(t,e){return this._promise=this._promise.then(t,e),this},m.prototype["catch"]=function(t){return this._promise=this._promise["catch"](t),this};var C=e(function(t){!function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&n.rotl(t,8)|4278255360&n.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=n.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],n=0,r=0;n<t.length;n++,r+=8)e[r>>>5]|=t[n]<<24-r%32;return e},wordsToBytes:function(t){for(var e=[],n=0;n<32*t.length;n+=8)e.push(t[n>>>5]>>>24-n%32&255);return e},bytesToHex:function(t){for(var e=[],n=0;n<t.length;n++)e.push((t[n]>>>4).toString(16)),e.push((15&t[n]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e},bytesToBase64:function(t){for(var n=[],r=0;r<t.length;r+=3)for(var o=t[r]<<16|t[r+1]<<8|t[r+2],i=0;4>i;i++)8*r+6*i<=8*t.length?n.push(e.charAt(o>>>6*(3-i)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,o=0;r<t.length;o=++r%4)0!=o&&n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*o+8)-1)<<2*o|e.indexOf(t.charAt(r))>>>6-2*o);return n}};t.exports=n}()}),H=function(t){return null!=t&&(g(t)||w(t)||!!t._isBuffer)},M={utf8:{stringToBytes:function(t){return M.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(M.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}},B=M,L=e(function(t){!function(){var e=C,n=B.utf8,r=H,o=B.bin,i=function(t,a){t.constructor==String?t=a&&"binary"===a.encoding?o.stringToBytes(t):n.stringToBytes(t):r(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||(t=t.toString());for(var s=e.bytesToWords(t),u=8*t.length,c=1732584193,f=-271733879,h=-1732584194,d=271733878,p=0;p<s.length;p++)s[p]=16711935&(s[p]<<8|s[p]>>>24)|4278255360&(s[p]<<24|s[p]>>>8);s[u>>>5]|=128<<u%32,s[(u+64>>>9<<4)+14]=u;for(var l=i._ff,y=i._gg,v=i._hh,m=i._ii,p=0;p<s.length;p+=16){var g=c,w=f,_=h,T=d;c=l(c,f,h,d,s[p+0],7,-680876936),d=l(d,c,f,h,s[p+1],12,-389564586),h=l(h,d,c,f,s[p+2],17,606105819),f=l(f,h,d,c,s[p+3],22,-1044525330),c=l(c,f,h,d,s[p+4],7,-176418897),d=l(d,c,f,h,s[p+5],12,1200080426),h=l(h,d,c,f,s[p+6],17,-1473231341),f=l(f,h,d,c,s[p+7],22,-45705983),c=l(c,f,h,d,s[p+8],7,1770035416),d=l(d,c,f,h,s[p+9],12,-1958414417),h=l(h,d,c,f,s[p+10],17,-42063),f=l(f,h,d,c,s[p+11],22,-1990404162),c=l(c,f,h,d,s[p+12],7,1804603682),d=l(d,c,f,h,s[p+13],12,-40341101),h=l(h,d,c,f,s[p+14],17,-1502002290),f=l(f,h,d,c,s[p+15],22,1236535329),c=y(c,f,h,d,s[p+1],5,-165796510),d=y(d,c,f,h,s[p+6],9,-1069501632),h=y(h,d,c,f,s[p+11],14,643717713),f=y(f,h,d,c,s[p+0],20,-373897302),c=y(c,f,h,d,s[p+5],5,-701558691),d=y(d,c,f,h,s[p+10],9,38016083),h=y(h,d,c,f,s[p+15],14,-660478335),f=y(f,h,d,c,s[p+4],20,-405537848),c=y(c,f,h,d,s[p+9],5,568446438),d=y(d,c,f,h,s[p+14],9,-1019803690),h=y(h,d,c,f,s[p+3],14,-187363961),f=y(f,h,d,c,s[p+8],20,1163531501),c=y(c,f,h,d,s[p+13],5,-1444681467),d=y(d,c,f,h,s[p+2],9,-51403784),h=y(h,d,c,f,s[p+7],14,1735328473),f=y(f,h,d,c,s[p+12],20,-1926607734),c=v(c,f,h,d,s[p+5],4,-378558),d=v(d,c,f,h,s[p+8],11,-2022574463),h=v(h,d,c,f,s[p+11],16,1839030562),f=v(f,h,d,c,s[p+14],23,-35309556),c=v(c,f,h,d,s[p+1],4,-1530992060),d=v(d,c,f,h,s[p+4],11,1272893353),h=v(h,d,c,f,s[p+7],16,-155497632),f=v(f,h,d,c,s[p+10],23,-1094730640),c=v(c,f,h,d,s[p+13],4,681279174),d=v(d,c,f,h,s[p+0],11,-358537222),h=v(h,d,c,f,s[p+3],16,-722521979),f=v(f,h,d,c,s[p+6],23,76029189),c=v(c,f,h,d,s[p+9],4,-640364487),d=v(d,c,f,h,s[p+12],11,-421815835),h=v(h,d,c,f,s[p+15],16,530742520),f=v(f,h,d,c,s[p+2],23,-995338651),c=m(c,f,h,d,s[p+0],6,-198630844),d=m(d,c,f,h,s[p+7],10,1126891415),h=m(h,d,c,f,s[p+14],15,-1416354905),f=m(f,h,d,c,s[p+5],21,-57434055),c=m(c,f,h,d,s[p+12],6,1700485571),d=m(d,c,f,h,s[p+3],10,-1894986606),h=m(h,d,c,f,s[p+10],15,-1051523),f=m(f,h,d,c,s[p+1],21,-2054922799),c=m(c,f,h,d,s[p+8],6,1873313359),d=m(d,c,f,h,s[p+15],10,-30611744),h=m(h,d,c,f,s[p+6],15,-1560198380),f=m(f,h,d,c,s[p+13],21,1309151649),c=m(c,f,h,d,s[p+4],6,-145523070),d=m(d,c,f,h,s[p+11],10,-1120210379),h=m(h,d,c,f,s[p+2],15,718787259),f=m(f,h,d,c,s[p+9],21,-343485551),c=c+g>>>0,f=f+w>>>0,h=h+_>>>0,d=d+T>>>0}return e.endian([c,f,h,d])};i._ff=function(t,e,n,r,o,i,a){var s=t+(e&n|~e&r)+(o>>>0)+a;return(s<<i|s>>>32-i)+e},i._gg=function(t,e,n,r,o,i,a){var s=t+(e&r|n&~r)+(o>>>0)+a;return(s<<i|s>>>32-i)+e},i._hh=function(t,e,n,r,o,i,a){var s=t+(e^n^r)+(o>>>0)+a;return(s<<i|s>>>32-i)+e},i._ii=function(t,e,n,r,o,i,a){var s=t+(n^(e|~r))+(o>>>0)+a;return(s<<i|s>>>32-i)+e},i._blocksize=16,i._digestsize=16,t.exports=function(t,n){if(void 0===t||null===t)throw new Error("Illegal argument "+t);var r=e.wordsToBytes(i(t,n));return n&&n.asBytes?r:n&&n.asString?o.bytesToString(r):e.bytesToHex(r)}}()}),U="mw-ttid",G="mw-t",F="data",q="mw-appkey",W="mw-sign",J=Object.prototype.hasOwnProperty;"function"!=typeof Date.now&&(Date.now=function(){return(new Date).valueOf()}),T.getSignedParams=function(t,e){var n=new T(t);return n.getSignedParams(e)},T.prototype.add=function(t,e){return e&&(this._params[t]=e),this},T.prototype.sign=function(t,e,n,r){var o=[],i=this._params;for(var a in i)J.call(i,a)&&o.push(a);return o.sort(),L(o.map(function(t){return i[t]}).concat([t,e,L(n),r]).join("&"))},T.prototype.getSignedParams=function(t){return this.add(W,this.sign(t.api,t.version,_(t.data),t.getToken())),this.add(F,_(t.data)),this._params};var V=function(t,e,n,r){this.api=t,this.version=e,this.data=n,this.options=Object.assign({},V.defaultOptions,r),this.origin=this.getOrigin(),this.retries=0};return V.Promise=E,V.AppKey="100028",V.TTID="NMMain@mgj_pc_1.0",V.Env=D,V.Hostname=k,V.Code=I,V.defaultOptions={useHTTPS:!1,env:V.Env.Release},V.request=function(t,e,n,r){return new V(t,e,n,r)._fetch()},V.getDSL=function(){return new m(this)},V.getDSLParameter=function(){return new m.Parameter},V.filterResult=d,V.setGlobalEnv=function(t){t&&(this.defaultOptions.env=t)},V.getGlobalEnv=function(){return this.defaultOptions.env},V.prototype={constructor:V,getToken:function(){return n(N)},getParams:function(){return T.getSignedParams(this.constructor,this)},shouldRetry:function(){return this.retries<5},_fetch:function(){var t=this;return new E(function(e,n){return t.shouldRetry()?(t.retries++,void t.fetch(e,n)):n(new Error("Have retried too much times"))}).then(function(e){return t.handleResponse(e)})},fetch:function(t,e){var n=[this.getURL(),this.getParams(),function(n,r){return n?e(n):void t(r)}];this.options.cors===!0?this.cors.apply(this,n):this.jsonp.apply(this,n)},jsonp:function(t,e,n){i(t,{data:e,jsonpCallback:"mwpCb"+h()},n)},cors:function(t,e,n){var r={method:this.options.method||"GET",data:e,dataType:"json",contentType:O.form};"function"==typeof window.fetch?s(t,r,n):window.XMLHttpRequest?a(t,r,n):this.jsonp(t,e,n)},getURL:function(){return this.origin+"/h5/"+this.api+"/"+this.version+"/"},getOrigin:function(){var t,e=this.options,n=e.useHTTPS?"https:":"http:";switch(e.env){case V.Env.Develop:t=V.Hostname.Develop;break;case V.Env.PreRelease:t=V.Hostname.PreRelease;break;default:t=V.Hostname.Release}return n+"//"+t},handleResponse:function(t){switch(t.ret){case V.Code.TokenNeedRenew:return this._fetch();case V.Code.NeedHttps:return this.options.useHTTPS=!0,this.origin=this.getOrigin(),this._fetch();default:return E.resolve(t)}}},V.setGlobalEnv(p()||l()),V}()}(this.M||this.MoGu||this);
